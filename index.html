<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Layout Cetak KTP A4 Fleksibel</title>
    <!-- Memuat Tailwind CSS untuk tampilan modern dan responsif -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Menggunakan font Inter */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
        }

        /* Container utama untuk area input, disembunyikan saat mencetak */
        @media print {
            .print-hidden {
                display: none !important;
            }

            /* Hapus margin dan padding default body saat mencetak */
            body {
                margin: 0;
                padding: 0;
            }

            /* Container cetak harus mengisi satu halaman A4 */
            #printContainer {
                width: 210mm; /* Lebar A4 */
                height: 297mm; /* Tinggi A4 */
                margin: 0;
                padding: 5mm; /* Padding minimal untuk estetika cetak */
                box-sizing: border-box;
                display: flex;
                flex-wrap: wrap;
                align-content: flex-start;
                justify-content: flex-start;
            }

            /* Gaya untuk setiap kartu KTP yang akan dicetak */
            .card-slot {
                /* Ukuran standar KTP/Kartu Kredit: 85.6mm x 53.98mm */
                /* Kita bulatkan menjadi 86mm x 54mm */
                width: 86mm;
                height: 54mm;
                /* Margin bawah agar ada jarak antar baris */
                margin-bottom: 5mm;
                overflow: hidden; /* Penting untuk menjaga ukuran */
            }

            /* PENTING: Margin untuk kolom KIRI, agar muat 2 kolom di A4 (Total sisa ruang 28mm) */
            .card-slot.left-column {
                margin-right: 28mm; 
            }

            /* PENTING: Margin untuk kolom KANAN, agar baris selanjutnya dimulai dari kiri */
            .card-slot.right-column {
                margin-right: 0;
            }

            .card-slot img {
                width: 100%;
                height: 100%;
                object-fit: cover; /* Pastikan gambar mengisi slot tanpa distorsi berlebihan */
            }

            /* Hapus border di cetakan akhir */
            .card-slot {
                border: none !important;
            }
        }

        /* Gaya visual untuk pratinjau di layar */
        .card-slot-preview {
            width: 100%; /* Agar responsif di grid */
            height: 80px; /* Tinggi pratinjau */
            border: 2px dashed #4f46e5;
            background-color: #eef2ff;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6366f1;
            overflow: hidden;
            position: relative;
        }
        .card-slot-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <!-- Kontrol Input (Disembunyikan saat Mencetak) -->
    <div class="print-hidden max-w-5xl mx-auto mb-10 p-6 bg-white shadow-2xl rounded-xl">
        <h1 class="text-3xl font-extrabold text-indigo-700 mb-4">Aplikasi Layout Cetak Kartu (KTP) A4 Fleksibel (8 Slot)</h1>
        <p class="text-gray-600 mb-6">Unggah 1 hingga 8 foto untuk ditempatkan pada layout 2 kolom kertas A4. Setiap kartu akan dicetak dengan ukuran standar KTP (86mm x 54mm).</p>

        <!-- Area Unggah Foto (8 Slot) -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Loop untuk 8 input file -->
            <script>
                // Generate 8 file upload inputs dynamically
                document.write(
                    Array.from({ length: 8 }, (_, i) => {
                        const index = i + 1;
                        return `
                            <div>
                                <label for="fileInput${index}" class="block text-sm font-medium text-gray-700 mb-2">Slot #${index}</label>
                                <input type="file" id="fileInput${index}" accept="image/*" 
                                    class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" 
                                    onchange="handleFileUpload(${i})">
                            </div>
                        `;
                    }).join('')
                );
            </script>
        </div>

        <!-- Tombol Cetak -->
        <button id="printButton" onclick="window.print()" disabled class="w-full py-3 px-4 rounded-lg text-white font-bold transition duration-300 bg-gray-400 cursor-not-allowed shadow-md">
            Siap Mencetak (Unggah Minimal 1 Foto)
        </button>
        <p id="statusMessage" class="text-center text-sm mt-3 text-red-500 hidden">Silakan unggah minimal satu foto untuk mengaktifkan tombol cetak.</p>
    </div>

    <!-- Area Pratinjau (Hanya terlihat di layar, bukan cetakan) -->
    <div class="print-hidden max-w-5xl mx-auto mb-10 p-6 bg-white shadow-2xl rounded-xl">
        <h2 class="text-2xl font-semibold text-gray-800 mb-4">Pratinjau Slot Cetak (8 Slot)</h2>
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
            <!-- Loop untuk 8 slot pratinjau -->
            <script>
                // Generate 8 preview slots dynamically
                document.write(
                    Array.from({ length: 8 }, (_, i) => {
                        const index = i + 1;
                        return `
                            <div id="previewSlot${index}" class="card-slot-preview rounded-lg">
                                <span class="text-xs font-semibold">Slot ${index}</span>
                            </div>
                        `;
                    }).join('')
                );
            </script>
        </div>
        <p class="text-center text-sm text-indigo-500 mt-4">Pratinjau ini hanya menunjukkan rasio gambar yang telah diunggah.</p>
    </div>

    <!-- Area Konten Cetak (Disiapkan untuk A4) -->
    <div id="printContainer" class="hidden">
        <!-- Konten cetak akan diisi oleh JavaScript di sini -->
    </div>

    <script>
        // Variabel global untuk menyimpan data URL gambar (8 slot: Index 0 hingga 7)
        const MAX_SLOTS = 8;
        let imageURLs = new Array(MAX_SLOTS).fill(null);
        
        /**
         * Mengubah file yang diunggah menjadi Data URL dan memperbarui pratinjau.
         * @param {number} index - Index slot (0 sampai 7)
         */
        function handleFileUpload(index) {
            const fileInput = document.getElementById(`fileInput${index + 1}`);
            const file = fileInput.files[0];
            const previewElement = document.getElementById(`previewSlot${index + 1}`);
            
            // Hapus konten pratinjau sebelumnya
            previewElement.innerHTML = `<span class="text-xs font-semibold">Slot ${index + 1}</span>`;

            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const dataURL = e.target.result;
                    imageURLs[index] = dataURL;

                    // Tampilkan di pratinjau layar
                    const img = document.createElement('img');
                    img.src = dataURL;
                    img.alt = `Pratinjau Slot ${index + 1}`;
                    img.classList.add('rounded-md');
                    previewElement.innerHTML = ''; // Kosongkan placeholder
                    previewElement.appendChild(img);
                    
                    // Setelah unggahan, perbarui layout cetak dan status tombol
                    updatePrintLayout();
                    checkReadyToPrint();
                };
                reader.readAsDataURL(file);
            } else {
                imageURLs[index] = null;
                // Jika file dihapus/dibatalkan, kembalikan ke label default
                updatePrintLayout();
                checkReadyToPrint();
            }
        }
        
        /**
         * Memeriksa apakah minimal satu slot sudah diunggah dan mengaktifkan tombol cetak.
         */
        function checkReadyToPrint() {
            const printButton = document.getElementById('printButton');
            const statusMessage = document.getElementById('statusMessage');

            // Cek apakah ada minimal satu URL gambar yang tidak null
            const isReady = imageURLs.some(url => url !== null); 

            if (isReady) {
                printButton.disabled = false;
                printButton.classList.remove('bg-gray-400', 'cursor-not-allowed');
                printButton.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
                printButton.textContent = 'Klik untuk Mencetak Layout KTP (A4)';
                statusMessage.classList.add('hidden');
            } else {
                printButton.disabled = true;
                printButton.classList.add('bg-gray-400', 'cursor-not-allowed');
                printButton.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                printButton.textContent = 'Siap Mencetak (Unggah Minimal 1 Foto)';
                statusMessage.classList.remove('hidden');
            }
        }

        /**
         * Membuat ulang konten di printContainer berdasarkan gambar yang tersedia.
         * PENTING: Menerapkan logika 2 kolom.
         */
        function updatePrintLayout() {
            const container = document.getElementById('printContainer');
            container.innerHTML = ''; // Kosongkan konten lama
            let activeSlots = 0;
            let currentColumn = 0; // 0 = kiri, 1 = kanan

            // Iterasi melalui 8 slot
            for (let i = 0; i < MAX_SLOTS; i++) {
                const dataUrl = imageURLs[i];
                
                if (dataUrl) {
                    // Hanya tambahkan slot jika URL gambar ada
                    const cardSlot = createCardSlot(dataUrl);
                    
                    // Tentukan apakah slot ini di kolom kiri atau kanan
                    if (currentColumn % 2 === 0) {
                        // Kolom Kiri: beri margin kanan 28mm
                        cardSlot.classList.add('left-column');
                    } else {
                        // Kolom Kanan: margin kanan 0, ini akan memaksa wrap ke baris baru
                        cardSlot.classList.add('right-column');
                    }

                    container.appendChild(cardSlot);
                    activeSlots++;
                    currentColumn++;
                }
            }
            
            // Kelola visibilitas container cetak
            if (activeSlots > 0) {
                container.classList.remove('hidden');
            } else {
                container.classList.add('hidden');
            }
        }

        /**
         * Fungsi pembantu untuk membuat elemen slot kartu.
         * @param {string} dataUrl - Data URL gambar
         */
        function createCardSlot(dataUrl) {
            const div = document.createElement('div');
            div.classList.add('card-slot'); // Menggunakan class untuk styling cetak
            
            const img = document.createElement('img');
            img.src = dataUrl;
            img.alt = 'Kartu yang dicetak';
            
            div.appendChild(img);
            return div;
        }

        // Jalankan pengecekan status saat halaman dimuat
        document.addEventListener('DOMContentLoaded', checkReadyToPrint);

    </script>
</body>
</html>
