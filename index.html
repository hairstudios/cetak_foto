<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Layout Cetak KTP A4</title>
    <!-- Memuat Tailwind CSS untuk tampilan modern dan responsif -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Menggunakan font Inter */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
        }

        /* Container utama untuk area input, disembunyikan saat mencetak */
        @media print {
            .print-hidden {
                display: none !important;
            }

            /* Hapus margin dan padding default body saat mencetak */
            body {
                margin: 0;
                padding: 0;
            }

            /* Container cetak harus mengisi satu halaman A4 */
            #printContainer {
                width: 210mm; /* Lebar A4 */
                height: 297mm; /* Tinggi A4 */
                margin: 0;
                padding: 5mm; /* Padding minimal untuk estetika cetak */
                box-sizing: border-box;
                display: flex;
                flex-wrap: wrap;
                align-content: flex-start;
                justify-content: flex-start;
            }

            /* Gaya untuk setiap kartu KTP yang akan dicetak */
            .card-slot {
                /* Ukuran standar KTP/Kartu Kredit: 85.6mm x 53.98mm */
                /* Kita bulatkan menjadi 86mm x 54mm */
                width: 86mm;
                height: 54mm;
                /* Margin agar muat 2 kolom di A4 (2 x 86mm = 172mm, sisa 38mm untuk margin/padding) */
                margin-right: 18mm; 
                margin-bottom: 5mm;
                border: 1px solid #ccc; /* Border agar terlihat lebih jelas di cetakan */
                overflow: hidden; /* Penting untuk menjaga ukuran */
            }

            .card-slot img {
                width: 100%;
                height: 100%;
                object-fit: cover; /* Pastikan gambar mengisi slot tanpa distorsi berlebihan */
            }

            /* Hapus border di cetakan akhir (opsional, tergantung preferensi) */
            .card-slot {
                border: none !important;
            }
        }

        /* Gaya visual untuk pratinjau di layar */
        .card-slot-preview {
            width: 150px;
            height: 94px; /* Rasio 86:54 */
            border: 2px dashed #4f46e5;
            background-color: #eef2ff;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6366f1;
            overflow: hidden;
            position: relative;
        }
        .card-slot-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <!-- Kontrol Input (Disembunyikan saat Mencetak) -->
    <div class="print-hidden max-w-4xl mx-auto mb-10 p-6 bg-white shadow-xl rounded-xl">
        <h1 class="text-3xl font-extrabold text-indigo-700 mb-4">Aplikasi Layout Cetak Kartu (KTP) A4</h1>
        <p class="text-gray-600 mb-6">Unggah foto KTP (Depan & Belakang), dan sistem akan menatanya dalam format 2 kolom untuk dicetak di kertas A4. Setiap kartu akan dicetak dengan ukuran KTP standar (86mm x 54mm).</p>

        <div class="grid md:grid-cols-2 gap-6 mb-8">
            <!-- Unggah Sisi Depan -->
            <div>
                <label for="fileInputFront" class="block text-sm font-medium text-gray-700 mb-2">1. Unggah Sisi Depan KTP</label>
                <input type="file" id="fileInputFront" accept="image/*" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" onchange="handleFileUpload('front')">
            </div>
            
            <!-- Unggah Sisi Belakang -->
            <div>
                <label for="fileInputBack" class="block text-sm font-medium text-gray-700 mb-2">2. Unggah Sisi Belakang KTP</label>
                <input type="file" id="fileInputBack" accept="image/*" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" onchange="handleFileUpload('back')">
            </div>
        </div>

        <!-- Tombol Cetak -->
        <button id="printButton" onclick="window.print()" disabled class="w-full py-3 px-4 rounded-lg text-white font-bold transition duration-300 bg-gray-400 cursor-not-allowed shadow-md">
            Siap Mencetak (Unggah Kedua Sisi Dahulu)
        </button>
        <p id="statusMessage" class="text-center text-sm mt-3 text-red-500 hidden">Pastikan Anda telah mengunggah kedua sisi foto.</p>
    </div>

    <!-- Area Pratinjau (Hanya terlihat di layar, bukan cetakan) -->
    <div class="print-hidden max-w-4xl mx-auto mb-10 p-6 bg-white shadow-xl rounded-xl">
        <h2 class="text-2xl font-semibold text-gray-800 mb-4">Pratinjau Layout Cetak (2 Kolom)</h2>
        <div class="flex flex-wrap justify-center gap-4">
            <!-- Slot Pratinjau Depan -->
            <div id="previewFront" class="card-slot-preview rounded-lg">
                <span class="text-xs font-semibold">Sisi Depan</span>
            </div>
            <!-- Slot Pratinjau Belakang -->
            <div id="previewBack" class="card-slot-preview rounded-lg">
                <span class="text-xs font-semibold">Sisi Belakang</span>
            </div>
        </div>
        <p class="text-center text-sm text-indigo-500 mt-4">Pratinjau ini hanya menunjukkan ukuran rasio, tata letak cetak sesungguhnya akan muncul saat Anda menekan tombol "Cetak".</p>
    </div>

    <!-- Area Konten Cetak (Disiapkan untuk A4) -->
    <div id="printContainer" class="hidden">
        <!-- Konten cetak akan diisi oleh JavaScript di sini -->
    </div>

    <script>
        // Variabel global untuk menyimpan data URL gambar
        let imageURLs = {
            front: null,
            back: null
        };
        
        // Konstanta untuk jumlah duplikasi
        const DUP_COUNT = 4;

        /**
         * Mengubah file yang diunggah menjadi Data URL dan memperbarui pratinjau.
         * @param {string} side - 'front' atau 'back'
         */
        function handleFileUpload(side) {
            const fileInput = document.getElementById(`fileInput${side.charAt(0).toUpperCase() + side.slice(1)}`);
            const file = fileInput.files[0];
            const previewElement = document.getElementById(`preview${side.charAt(0).toUpperCase() + side.slice(1)}`);
            
            // Hapus konten pratinjau sebelumnya
            previewElement.innerHTML = ''; 

            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const dataURL = e.target.result;
                    imageURLs[side] = dataURL;

                    // Tampilkan di pratinjau layar
                    const img = document.createElement('img');
                    img.src = dataURL;
                    img.alt = `Pratinjau Sisi ${side}`;
                    img.classList.add('rounded-md');
                    previewElement.appendChild(img);
                    
                    // Setelah unggahan, perbarui layout cetak
                    updatePrintLayout();
                    checkReadyToPrint();
                };
                reader.readAsDataURL(file);
            } else {
                imageURLs[side] = null;
                // Jika file dihapus/dibatalkan, kembalikan ke label default
                previewElement.innerHTML = `<span class="text-xs font-semibold">Sisi ${side.charAt(0).toUpperCase() + side.slice(1)}</span>`;
                updatePrintLayout();
                checkReadyToPrint();
            }
        }
        
        /**
         * Memeriksa apakah kedua sisi sudah diunggah dan mengaktifkan tombol cetak.
         */
        function checkReadyToPrint() {
            const printButton = document.getElementById('printButton');
            const statusMessage = document.getElementById('statusMessage');

            if (imageURLs.front && imageURLs.back) {
                printButton.disabled = false;
                printButton.classList.remove('bg-gray-400', 'cursor-not-allowed');
                printButton.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
                printButton.textContent = 'Klik untuk Mencetak Layout KTP (A4)';
                statusMessage.classList.add('hidden');
            } else {
                printButton.disabled = true;
                printButton.classList.add('bg-gray-400', 'cursor-not-allowed');
                printButton.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                printButton.textContent = 'Siap Mencetak (Unggah Kedua Sisi Dahulu)';
                statusMessage.classList.remove('hidden');
            }
        }

        /**
         * Membuat ulang konten di printContainer berdasarkan gambar yang tersedia.
         */
        function updatePrintLayout() {
            const container = document.getElementById('printContainer');
            container.innerHTML = ''; // Kosongkan konten lama

            if (imageURLs.front && imageURLs.back) {
                // Tampilkan container cetak
                container.classList.remove('hidden');

                // Kita akan membuat 4 pasang kartu (Depan - Belakang)
                for (let i = 0; i < DUP_COUNT; i++) {
                    // Slot KTP Sisi Depan
                    const frontSlot = createCardSlot(imageURLs.front);
                    container.appendChild(frontSlot);

                    // Slot KTP Sisi Belakang
                    const backSlot = createCardSlot(imageURLs.back);
                    container.appendChild(backSlot);
                }
            } else {
                // Sembunyikan container cetak jika belum ada gambar yang lengkap
                container.classList.add('hidden');
            }
        }

        /**
         * Fungsi pembantu untuk membuat elemen slot kartu.
         * @param {string} dataUrl - Data URL gambar
         */
        function createCardSlot(dataUrl) {
            const div = document.createElement('div');
            div.classList.add('card-slot'); // Menggunakan class untuk styling cetak
            
            const img = document.createElement('img');
            img.src = dataUrl;
            img.alt = 'Kartu yang dicetak';
            
            div.appendChild(img);
            return div;
        }

        // Jalankan pengecekan status saat halaman dimuat
        document.addEventListener('DOMContentLoaded', checkReadyToPrint);

    </script>
</body>
</html>
